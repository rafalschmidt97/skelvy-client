<ng-container
  *ngIf="
    suggestions &&
    (suggestions.meetingRequests.length > 0 || suggestions.meetings.length > 0)
  "
>
  <label [class.d-none]="!inForm" [innerText]="'Suggestions' | translate">
  </label>
  <div
    class="suggestions bg-primary"
    [class.disabled]="isLoading"
    [class.form]="inForm"
  >
    <div
      class="meetings"
      *ngIf="suggestions.meetings.length > 0"
      [class.has-sibling]="suggestions.meetingRequests.length > 0"
    >
      <label
        [innerText]="'Near meetings to join' | translate"
        class="text-white"
      ></label>
      <div
        *ngFor="let meeting of suggestions.meetings"
        class="d-flex align-items-center bg-white mb-1 item"
      >
        <div class="py-2 pl-2" (click)="openMeetingDetails(meeting)">
          <div>
            <span class="font-weight-bold">{{ 'Date' | translate }}</span
            >: {{ meeting.date | date: 'dd.MM.yyyy' }}
          </div>
          <div>
            <span class="font-weight-bold">{{ 'City' | translate }}</span
            >: {{ meeting.city }}
          </div>
          <div>
            <span class="font-weight-bold">{{ 'People' | translate }}</span
            >: {{ meeting.users.length }}
          </div>
          <div>
            <span class="font-weight-bold">{{ 'Drink' | translate }}</span
            >: {{ meeting.drinkType.name | translate }}
          </div>
        </div>
        <div
          class="join text-primary ml-auto align-self-stretch d-flex align-items-center px-3"
          [innerText]="'join' | translate"
          (click)="join.emit(meeting.id)"
        ></div>
      </div>
    </div>
    <div class="requests" *ngIf="suggestions.meetingRequests.length > 0">
      <label
        [innerText]="'Near requests to connect' | translate"
        class="text-white"
      ></label>
      <div
        *ngFor="let request of suggestions.meetingRequests"
        class="d-flex align-items-center bg-white mb-1 item"
      >
        <div class="py-2 pl-2" (click)="openRequestDetails(request)">
          <div>
            <span class="font-weight-bold">{{ 'Date' | translate }}</span
            >: {{ getDate(request.minDate, request.maxDate) }}
          </div>
          <div>
            <span class="font-weight-bold">{{ 'City' | translate }}</span
            >: {{ request.city }}
          </div>
          <div>
            <span class="font-weight-bold">{{ 'Drinks' | translate }}</span
            >:
            <ng-container
              *ngFor="let drink of request.drinkTypes; let i = index"
            >
              <span class="d-inline-block">{{ drink.name | translate }}</span>
              <span *ngIf="i !== request.drinkTypes.length - 1">, </span>
            </ng-container>
          </div>
        </div>
        <div
          class="join text-primary ml-auto align-self-stretch d-flex align-items-center px-3"
          [innerText]="'connect' | translate"
          (click)="connect.emit(request.id)"
        ></div>
      </div>
    </div>
    <div class="information text-white">
      {{ 'Suggestions are based on your selected address.' | translate }}
    </div>
  </div>
</ng-container>

<ng-template #meetingPreview>
  <app-modal>
    <ion-slides
      pager="true"
      class="slider pt-2"
      [options]="{ autoplay: { delay: 6000 } }"
    >
      <ion-slide *ngFor="let user of previewMeeting.users">
        <div class="profile d-flex align-items-center">
          <div
            class="flex-shrink-0 image rounded-circle"
            [style.background-image]="'url(' + user.profile.photos[0].url + ')'"
          ></div>
          <div class="min-width mx-3">
            <h3 class="mb-0 text-primary">
              {{ user.profile.name }}, {{ user.profile.birthday | age }}
            </h3>
          </div>
        </div>
      </ion-slide>
    </ion-slides>
    <div class="px-4 pb-4">
      <div class="pt-3 pb-4">
        <div>
          <span class="font-weight-bold">{{ 'Date' | translate }}</span
          >: {{ previewMeeting.date | date: 'dd.MM.yyyy' }}
        </div>
        <div>
          <span class="font-weight-bold">{{ 'City' | translate }}</span
          >: {{ previewMeeting.city }}
        </div>
        <div>
          <span class="font-weight-bold">{{ 'People' | translate }}</span
          >: {{ previewMeeting.users.length }}
        </div>
        <div>
          <span class="font-weight-bold">{{ 'Drink' | translate }}</span
          >: {{ previewMeeting.drinkType.name | translate }}
        </div>
      </div>
      <button
        type="button"
        class="btn btn-primary btn-block"
        (click)="joinMeeting(previewMeeting.id)"
      >
        {{ 'Join meeting' | translate }}
      </button>
      <button type="button" class="btn btn-light btn-block" (click)="decline()">
        {{ 'Cancel' | translate }}
      </button>
    </div>
  </app-modal>
</ng-template>

<ng-template #requestPreview>
  <app-modal>
    <div
      class="profile py-3 d-flex align-items-center justify-content-center"
      *ngIf="previewRequest.user as user"
    >
      <div
        class="flex-shrink-0 image rounded-circle"
        [style.background-image]="'url(' + user.profile.photos[0].url + ')'"
      ></div>
      <div class="min-width mx-3">
        <h3 class="mb-0 text-primary">
          {{ user.profile.name }}, {{ user.profile.birthday | age }}
        </h3>
      </div>
    </div>
    <div class="px-4 pb-4">
      <div class="border-top mt-2 py-4">
        <div>
          <span class="font-weight-bold">{{ 'Date' | translate }}</span
          >: {{ getDate(previewRequest.minDate, previewRequest.maxDate) }}
        </div>
        <div>
          <span class="font-weight-bold">{{ 'City' | translate }}</span
          >: {{ previewRequest.city }}
        </div>
        <div>
          <span class="font-weight-bold">{{ 'Drinks' | translate }}</span
          >:
          <ng-container
            *ngFor="let drink of previewRequest.drinkTypes; let i = index"
          >
            <span class="d-inline-block">{{ drink.name | translate }}</span>
            <span *ngIf="i !== previewRequest.drinkTypes.length - 1">, </span>
          </ng-container>
        </div>
      </div>
      <button
        type="button"
        class="btn btn-primary btn-block"
        (click)="connectRequest(previewRequest.id)"
      >
        {{ 'Connect request' | translate }}
      </button>
      <button type="button" class="btn btn-light btn-block" (click)="decline()">
        {{ 'Cancel' | translate }}
      </button>
    </div>
  </app-modal>
</ng-template>
